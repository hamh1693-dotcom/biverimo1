<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bivermio Arama</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  #results { max-height: 400px; overflow-y: auto; }
  .result-item { transition: all 0.2s; display: flex; align-items: center; padding: 0.5rem 1rem; cursor: pointer; }
  .result-item:hover, .result-item.active { transform: translateX(5px); background-color: #e0f2fe; }
  .result-icon { width: 24px; height: 24px; margin-right: 10px; }
</style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">

<h1 class="text-3xl font-bold mb-6">Bivermio Arama</h1>

<div class="w-full max-w-xl mb-4">
  <input type="text" id="search" placeholder="Site veya uygulama ara..." 
    class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400">
</div>

<!-- Kategori filtreleri -->
<div class="w-full max-w-xl flex gap-2 mb-4 flex-wrap">
  <button class="filter-btn bg-blue-500 text-white px-3 py-1 rounded-lg" data-category="Yapay Zekâ">Yapay Zekâ</button>
  <button class="filter-btn bg-green-500 text-white px-3 py-1 rounded-lg" data-category="Sosyal Medya">Sosyal Medya</button>
  <button class="filter-btn bg-purple-500 text-white px-3 py-1 rounded-lg" data-category="Video">Video</button>
  <button class="filter-btn bg-yellow-500 text-white px-3 py-1 rounded-lg" data-category="İletişim">İletişim</button>
  <button class="filter-btn bg-gray-500 text-white px-3 py-1 rounded-lg" data-category="Tüm">Tüm</button>
</div>

<ul id="results" class="w-full max-w-xl bg-white rounded-lg shadow-md"></ul>

<script>
const searchInput = document.getElementById('search');
const resultsList = document.getElementById('results');
let currentCategory = "Tüm";
let activeIndex = -1;
let currentResults = [];

const filterButtons = document.querySelectorAll('.filter-btn');
filterButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        currentCategory = btn.dataset.category;
        searchInput.dispatchEvent(new Event('input'));
    });
});

let timeout = null;

searchInput.addEventListener('input', () => {
    clearTimeout(timeout);
    timeout = setTimeout(async () => {
        const query = searchInput.value.trim();
        if (!query && currentCategory === "Tüm") {
            resultsList.innerHTML = '';
            currentResults = [];
            activeIndex = -1;
            return;
        }
        try {
            let url = `http://localhost:3000/search?q=${query}`;
            if (currentCategory !== "Tüm") url += `&category=${currentCategory}`;
            const res = await fetch(url);
            const data = await res.json();
            currentResults = data;
            activeIndex = -1;

            resultsList.innerHTML = data.map((item, i) => `
                <li class="result-item" data-index="${i}">
                  <img src="https://www.google.com/s2/favicons?domain=${item.url}" class="result-icon" />
                  <span class="flex justify-between w-full">
                    <span class="font-medium">${item.name}</span>
                    <span class="text-sm text-gray-500">${item.category}</span>
                  </span>
                </li>
            `).join('');

            // Click ile açma
            document.querySelectorAll('.result-item').forEach(el => {
                el.addEventListener('click', () => {
                    const index = parseInt(el.dataset.index);
                    window.open(currentResults[index].url, '_blank');
                });
            });

        } catch (e) {
            resultsList.innerHTML = '<li class="px-4 py-2 text-red-500">Arama sırasında hata oluştu</li>';
        }
    }, 200);
});

// Klavye ile navigasyon ve enter açma
searchInput.addEventListener('keydown', (e) => {
    if (!currentResults.length) return;
    const items = document.querySelectorAll('.result-item');
    if (e.key === 'ArrowDown') {
        e.preventDefault();
        activeIndex = (activeIndex + 1) % currentResults.length;
        updateActive(items);
    }
    if (e.key === 'ArrowUp') {
        e.preventDefault();
        activeIndex = (activeIndex - 1 + currentResults.length) % currentResults.length;
        updateActive(items);
    }
    if (e.key === 'Enter') {
        e.preventDefault();
        if (activeIndex >= 0) {
            window.open(currentResults[activeIndex].url, '_blank');
        } else if (currentResults.length) {
            window.open(currentResults[0].url, '_blank');
        }
    }
});

function updateActive(items) {
    items.forEach(el => el.classList.remove('active'));
    if (activeIndex >= 0) items[activeIndex].classList.add('active');
}
</script>

</body>
</html>
